import torch

from rdkit import Chem

TORCH_FLOAT = torch.float32
TORCH_INT = torch.int8

# #################################################################################### #
# ####################################### ZINC ####################################### #
# #################################################################################### #

# Atom idx for one-hot encoding
# ATOM2IDX = {'C': 0, 'O': 1, 'N': 2, 'F': 3, 'S': 4, 'Cl': 5, 'Br': 6, 'I': 7}
# IDX2ATOM = {0: 'C', 1: 'O', 2: 'N', 3: 'F', 4: 'S', 5: 'Cl', 6: 'Br', 7: 'I'}

ATOM2IDX = {'C': 0, 'N': 1, 'O': 2, 'S': 3, 'B': 4, 'Br': 5, 'Cl': 6, 'P': 7, 'I': 8, 'F': 9, 'Mg': 10, 'Si': 11,
            'Sn': 12, 'Zn': 13, 'Cu': 14, 'Se': 15}
IDX2ATOM = {0: 'C', 1: 'N', 2: 'O', 3: 'S', 4: 'B', 5: 'Br', 6: 'Cl', 7: 'P', 8: 'I', 9: 'F', 10: 'Mg', 11: 'Si',
            12: 'Sn', 13: 'Zn', 14: 'Cu', 15: 'Se'}
# ATOMDECODER = ['C', 'N', 'O', 'S', 'B', 'Br', 'Cl', 'P', 'I', 'F', 'Mg', 'Si', 'Sn', 'Zn', 'Cu', 'Se']

# Atomic numbers (Z)!!!!!!!
# CHARGES = {'C': 6, 'O': 8, 'N': 7, 'F': 9, 'S': 16, 'Cl': 17, 'Br': 35, 'I': 53}
# CHARGES = {'C': 6, 'O': 8, 'N': 7, 'F': 9, 'S': 16, 'Cl': 17, 'Br': 35, 'I': 53, 'B': 2, 'P': 30, 'Mg': 12, 'Si': 10, 'Sn': 10, 'Zn': 10, 'Cu': 10, 'Se':10}
CHARGES = {'C': 6, 'O': 8, 'N': 7, 'F': 9, 'S': 16, 'Cl': 17, 'Br': 35, 'I': 53, 'B': 5, 'P': 15, 'Mg': 12, 'Si': 14,
           'Sn': 50, 'Zn': 30, 'Cu': 29, 'Se': 34}
# check out Mg, Si, Sn, Zn, Cu, Se and similar
# I added them myself

# One-hot atom types
NUMBER_OF_ATOM_TYPES = len(ATOM2IDX)

# #################################################################################### #
# ####################################### GEOM ####################################### #
# #################################################################################### #

"""geom_no_h = {
    'name': 'geom',
    'atom_encoder': {'B': 0, 'C': 1, 'N': 2, 'O': 3, 'F': 4, 'Al': 5, 'Si': 6, 'P': 7, 'S': 8, 'Cl': 9, 'As': 10,
                     'Br': 11, 'I': 12, 'Hg': 13, 'Bi': 14},
    'atomic_nb': [5,  6,  7,  8,  9, 13, 14, 15, 16, 17, 33, 35, 53, 80, 83],
    'atom_decoder': ['B', 'C', 'N', 'O', 'F', 'Al', 'Si', 'P', 'S', 'Cl', 'As', 'Br', 'I', 'Hg', 'Bi'],
    'max_n_nodes': 91,
    'n_nodes': {1: 3, 2: 5, 3: 8, 4: 89, 5: 166, 6: 370, 7: 613, 8: 1214, 9: 1680, 10: 3315, 11: 5115, 12: 9873,
                13: 15422, 14: 28088, 15: 50643, 16: 82299, 17: 124341, 18: 178417, 19: 240446, 20: 308209, 21: 372900,
                22: 429257, 23: 477423, 24: 508377, 25: 522385, 26: 522000, 27: 507882, 28: 476702, 29: 426308,
                30: 375819, 31: 310124, 32: 255179, 33: 204441, 34: 149383, 35: 109343, 36: 71701, 37: 44050,
                38: 31437, 39: 20242, 40: 14971, 41: 10078, 42: 8049, 43: 4476, 44: 3130, 45: 1736, 46: 2030,
                47: 1110, 48: 840, 49: 750, 50: 540, 51: 810, 52: 591, 53: 453, 54: 540, 55: 720, 56: 300, 57: 360,
                58: 714, 59: 390, 60: 519, 61: 210, 62: 449, 63: 210, 64: 289, 65: 589, 66: 227, 67: 180, 68: 330,
                69: 330, 70: 150, 71: 60, 72: 210, 73: 60, 74: 180, 75: 120, 76: 30, 77: 150, 78: 30, 79: 60, 82: 60,
                85: 60, 86: 6, 87: 60, 90: 60, 91: 30},
    'atom_types': {0: 290, 1: 129988623, 2: 20266722, 3: 21669359, 4: 1481844, 5: 1, 6: 250, 7: 36290, 8: 3999872,
                   9: 1224394, 10: 4, 11: 298702, 12: 5377, 13: 13, 14: 34},
    'colors_dic': ['C0', 'C1', 'C2', 'C3', 'C4', 'C5', 'C6', 'C7', 'C8', 'C9', 'C10', 'C11', 'C12', 'C13', 'C14'],
    'radius_dic': [0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3],
    'with_h': False}"""

# Dataset keys
DATA_LIST_ATTRS = {
    'uuid', 'name', 'fragments_smi', 'linker_smi', 'num_atoms'
}
DATA_ATTRS_TO_PAD = {
    'positions', 'one_hot', 'charges', 'anchors', 'fragment_mask', 'linker_mask', 'pocket_mask', 'fragment_only_mask'
}
DATA_ATTRS_TO_ADD_LAST_DIM = {
    'charges', 'anchors', 'fragment_mask', 'linker_mask', 'pocket_mask', 'fragment_only_mask'
}

# Distribution of linker size in train data

LINKER_SIZE_DIST_TRAIN = {'0': 26616, '1': 27450, '2': 3142, '3': 2618, '4': 773, '5': 372, '6': 182, '7': 2553,
                          '8': 717,
                          '9': 898, '10': 488, '11': 11, '12': 1, '13': 200, '14': 3, '16': 2, '17': 25, '19': 181,
                          '20': 1, '22': 1, '23': 1, '32': 1, '34': 2}

LINKER_SIZE_DIST_final1 = {
    0: 24109,
    1: 20384,
    2: 2940,
    3: 2319,
    4: 510,
    5: 353,
    6: 162,
    7: 2271,
    8: 269,
    9: 831,
    10: 337,
    11: 14,
    12: 1,
    13: 163,
    14: 6,
    16: 1,
    17: 20,
    19: 130,
    20: 1,
    23: 1,
    33: 1,
    34: 3}

LINKER_SIZE_DIST_final = {
    1: 20750,
    2: 2942,
    3: 2309,
    4: 510,
    5: 365,
    6: 150,
    7: 2235,
    8: 274,
    9: 825,
    10: 356,
    11: 13,
    12: 1,
    13: 172,
    14: 5,
    16: 2,
    17: 21,
    19: 123,
    20: 1,
    33: 1,
    34: 3}
LINKER_SIZE_DIST_25 = {
    1: 4028,
    0: 4847,
    8: 52,
    3: 486,
    2: 607,
    7: 461,
    19: 17,
    13: 34,
    4: 118,
    9: 165,
    5: 87,
    10: 69,
    23: 1,
    6: 27,
    14: 2,
    11: 3,
    17: 2}

# Bond lengths from:
# http://www.wiredchemist.com/chemistry/data/bond_energies_lengths.html
# And:
# http://chemistry-reference.com/tables/Bond%20Lengths%20and%20Enthalpies.pdf
BONDS_1 = {
    'H': {
        'H': 74, 'C': 109, 'N': 101, 'O': 96, 'F': 92,
        'B': 119, 'Si': 148, 'P': 144, 'As': 152, 'S': 134,
        'Cl': 127, 'Br': 141, 'I': 161
    },
    'C': {
        'H': 109, 'C': 154, 'N': 147, 'O': 143, 'F': 135,
        'Si': 185, 'P': 184, 'S': 182, 'Cl': 177, 'Br': 194,
        'I': 214
    },
    'N': {
        'H': 101, 'C': 147, 'N': 145, 'O': 140, 'F': 136,
        'Cl': 175, 'Br': 214, 'S': 168, 'I': 222, 'P': 177
    },
    'O': {
        'H': 96, 'C': 143, 'N': 140, 'O': 148, 'F': 142,
        'Br': 172, 'S': 151, 'P': 163, 'Si': 163, 'Cl': 164,
        'I': 194
    },
    'F': {
        'H': 92, 'C': 135, 'N': 136, 'O': 142, 'F': 142,
        'S': 158, 'Si': 160, 'Cl': 166, 'Br': 178, 'P': 156,
        'I': 187
    },
    'B': {
        'H': 119, 'Cl': 175
    },
    'Si': {
        'Si': 233, 'H': 148, 'C': 185, 'O': 163, 'S': 200,
        'F': 160, 'Cl': 202, 'Br': 215, 'I': 243,
    },
    'Cl': {
        'Cl': 199, 'H': 127, 'C': 177, 'N': 175, 'O': 164,
        'P': 203, 'S': 207, 'B': 175, 'Si': 202, 'F': 166,
        'Br': 214
    },
    'S': {
        'H': 134, 'C': 182, 'N': 168, 'O': 151, 'S': 204,
        'F': 158, 'Cl': 207, 'Br': 225, 'Si': 200, 'P': 210,
        'I': 234
    },
    'Br': {
        'Br': 228, 'H': 141, 'C': 194, 'O': 172, 'N': 214,
        'Si': 215, 'S': 225, 'F': 178, 'Cl': 214, 'P': 222
    },
    'P': {
        'P': 221, 'H': 144, 'C': 184, 'O': 163, 'Cl': 203,
        'S': 210, 'F': 156, 'N': 177, 'Br': 222
    },
    'I': {
        'H': 161, 'C': 214, 'Si': 243, 'N': 222, 'O': 194,
        'S': 234, 'F': 187, 'I': 266
    },
    'As': {
        'H': 152
    }
}

BONDS_2 = {
    'C': {'C': 134, 'N': 129, 'O': 120, 'S': 160},
    'N': {'C': 129, 'N': 125, 'O': 121},
    'O': {'C': 120, 'N': 121, 'O': 121, 'P': 150},
    'P': {'O': 150, 'S': 186},
    'S': {'P': 186}
}

BONDS_3 = {
    'C': {'C': 120, 'N': 116, 'O': 113},
    'N': {'C': 116, 'N': 110},
    'O': {'C': 113}
}

BOND_DICT = [
    None,
    Chem.rdchem.BondType.SINGLE,
    Chem.rdchem.BondType.DOUBLE,
    Chem.rdchem.BondType.TRIPLE,
    Chem.rdchem.BondType.AROMATIC,
]

BOND2IDX = {
    Chem.rdchem.BondType.SINGLE: 1,
    Chem.rdchem.BondType.DOUBLE: 2,
    Chem.rdchem.BondType.TRIPLE: 3,
    Chem.rdchem.BondType.AROMATIC: 4,
}

ALLOWED_BONDS = {
    'H': 1,
    'C': 4,
    'N': 3,
    'O': 2,
    'F': 1,
    'B': 3,
    'Al': 3,
    'Si': 4,
    'P': [3, 5],
    'S': 4,
    'Cl': 1,
    'As': 3,
    'Br': 1,
    'I': 1,
    'Hg': [1, 2],
    'Bi': [3, 5]
}

MARGINS_EDM = [10, 5, 2]

COLORS = ['C0', 'C1', 'C2', 'C3', 'C4', 'C5', 'C6', 'C7', 'C8', 'C9', 'C10', 'C11', 'C12', 'C13', 'C14', 'C14']
RADII = [0.77, 0.77, 0.77, 0.77, 0.77, 0.77, 0.77, 0.77, 0.77, 0.77, 0.77, 0.77, 0.77, 0.77, 0.77, 0.77]

ZINC_TRAIN_LINKER_ID2SIZE = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 13, 19, 20]  # all the uncommon size will be redirected to the last one
# ZINC_TRAIN_LINKER_ID2SIZE = list(range(19))
# ZINC_TRAIN_LINKER_ID2SIZE = sorted([int(x) for x in LINKER_SIZE_DIST_TRAIN.keys()])
ZINC_TRAIN_LINKER_SIZE2ID = {
    size: idx
    for idx, size in enumerate(ZINC_TRAIN_LINKER_ID2SIZE)
}

# ZINC_TRAIN_LINKER_SIZE_WEIGHTS = [0.07677, 0.07677, 0.0768, 0.0768, 0.07687, 0.07698, 0.07719, 0.0768, 0.07688, 0.07686,
#                                   0.07693, 1.0, 1.0, 0.07716, 1.0, 1.0, 1.0, 0.0772, 1.0, 1.0, 1.0, 1.0, 1.0]
ZINC_TRAIN_LINKER_SIZE_WEIGHTS = [0.07677, 0.07677, 0.0768, 0.0768, 0.07687, 0.07698, 0.07719, 0.0768, 0.07688, 0.07686,
                                  0.07693, 0.07716, 0.0772, 1.0]
# ZINC_TRAIN_LINKER_SIZE_WEIGHTS = [
#     3.47347831e-01,
#     4.63079100e-01,
#     5.12370917e-01,
#     5.62392614e-01,
#     1.30294388e+00,
#     3.24247801e+00,
#     8.12391184e+00,
#     3.45634358e+01,
#     2.72428571e+02,
#     6.26585714e+03
# ]
